name: Create Zip File
on: 
  workflow_dispatch:
jobs:
  job1:
    runs-on: ubuntu-latest
    outputs:
      matrix: ${{ steps.set-matrix.outputs.matrix }}
    steps:
    - name: Get Mod Version Number
      id: mod_version
      uses:  ashley-taylor/read-json-property-action@v1.2
      with:
        path: ModConfig.json
        property: ModVersion
    - name: echo ModVersion
      run: echo ${{ steps.mod_version.outputs.value }}
      env:
        release_mod_version: ${{ steps.mod_version.outputs.value }}
    - name: Get Mod ID
      id: mod_id
      uses:  ashley-taylor/read-json-property-action@v1.2
      with:
        path: ModConfig.json
        property: ModId
    - name: echo ModId
      run: echo ${{ steps.mod_id.outputs.value }}}
      env:
        release_mod_id: ${{ steps.mod_id.outputs.value }}
    - id: set-matrix
      run: echo "::set-output name=matrix::{\"include\":[{\"project\":\"foo\",\"config\":\"Debug\"},{\"project\":\"bar\",\"config\":\"Release\"}]}"
  job2:
    needs: job1
    runs-on: ubuntu-latest
    strategy:
      matrix: ${{fromJson(needs.job1.outputs.matrix)}}
    steps:
  build:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@maste
      #build zip
    - name: Generate Name
      id: zip_name
      run: echo ${{ join((release_mod_id release_mod_version)) >> $GITHUB_OUTPUT }}        
    - name: echo Zip Name
      run: echo ${{ steps.zip_name.outputs.value }}}
    - name: Generate File Name
      id: zip_filename
      uses: aymen3009/slugifyAction@v1.1.1
      with:
        # string input
        string: steps.zip_name.outputs.value # default is Hello World
        suffix: ".zip"
        slugify: false
    - name: Generate ZIP
      uses: byteever/action-build-zip@master
      with:
        filename: steps.zip_filename.outputs.value
    - name: Create Release
        # You may pin to the exact commit or the version.
        # uses: ncipollo/release-action@2c591bcc8ecdcd2db72b97d6147f871fcd833ba5
      uses: ncipollo/release-action@v1.14.0
      with:
          allowUpdates: false
          generateReleaseNotes: true
          name: steps.mod_version.outputs.value
          skipIfReleaseExists: true
          tag: steps.mod_version.outputs.value
